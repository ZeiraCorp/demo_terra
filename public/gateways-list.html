<gateways-list class="ui container segment" style="font-size:16px">

  <!--
  <div class="ui ignored warning message">
    Hello üåç, this is the list of the gateways
  </div>
  -->
  <h4 class="ui header">Gateways</h4>
  <table class="ui celled table">
    <thead>
      <tr>
        <th>Gateway ID</th>
        <th>Host</th>
        <th>Port</th>
        <th>Services</th>
      </tr>
    </thead>
    <tbody>
      <tr each={ gateways }>
        <td><i class="info circle icon"></i><a href="#{id}">{id}</a></td>
        <td><i class="world icon"></i>{host}</td>
        <td>{port}</td>
        <td>{services}</td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <th colspan="4">
          <!--
          <div class="ui right floated pagination menu">
            <a class="icon item">
              <i class="left chevron icon"></i>
            </a>
            <a class="item">1</a>
            <a class="item">2</a>
            <a class="item">3</a>
            <a class="item">4</a>
            <a class="icon item">
              <i class="right chevron icon"></i>
            </a>
          </div>
          -->
        </th>
      </tr>
    </tfoot>
  </table>

  <script>
    console.log('=== gateways-list ===')

    this.opts.broker.observe(this)

    this.on("hi", function(data) {
      console.info("üêº", data)
    })


    updateGatewaysList() {
      fetch('/gateways/details', {
        method: 'GET',
        headers: {
          "Content-Type": "application/json"
        }
      })
      .then(response => response.json())
      .then(jsonData => {
        //console.log(jsonData)
        this.gateways = jsonData
        this.update()
      })
      .catch(error => console.error(error))
    }

    const timer = setInterval(this.updateGatewaysList, 1000)

    route((id) => {
      console.log(id)
      this.opts.broker.emit("gateways-list:click:id", id)
    })

    this.updateGatewaysList()

    this.on('unmount', () => {
      clearInterval(timer)
    })

  </script>
</gateways-list>
